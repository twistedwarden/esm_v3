import{a}from"./index-DATm8HeU.js";class s{constructor(){this.baseURL=a("/api")}async autoRegisterFromSSCApproval(e){try{console.log("Auto-registering student from SSC approval:",e);const t=this.extractStudentDataFromApplication(e),r=await this.createStudentFromApplication(t,e);return console.log("Student auto-registered successfully:",r),r}catch(t){throw console.error("Error auto-registering student:",t),t}}extractStudentDataFromApplication(e){const t=e.student||{},r=e.school||{};return{first_name:t.first_name||t.firstName||"",middle_name:t.middle_name||t.middleName||"",last_name:t.last_name||t.lastName||"",email:t.email_address||t.email||"",contact_number:t.contact_number||t.phone||"",citizen_id:t.citizen_id||"",current_school_id:r.id||e.school_id,year_level:t.year_level||t.current_year||"",program:t.program||t.course||"",enrollment_date:t.enrollment_date||new Date().toISOString(),academic_status:"enrolled",gpa:t.gpa||0,scholarship_status:"scholar",current_scholarship_id:e.id,approved_amount:e.approved_amount||0,scholarship_start_date:new Date().toISOString(),total_scholarships_received:1,financial_aid_records:[{type:"scholarship",amount:e.approved_amount||0,date:new Date().toISOString(),status:"disbursed"}],documents:[],notes:[{id:Date.now(),note:`Auto-registered from SSC approval of scholarship application #${e.application_number||e.id}`,created_by:"System",created_at:new Date().toISOString()}],status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}async createStudentFromApplication(e,t){try{const r=await fetch(`${this.baseURL}/students/register-from-scholarship`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({application_id:t.id,student_data:e,scholarship_data:{application_number:t.application_number,category_id:t.category_id,subcategory_id:t.subcategory_id,approved_amount:t.approved_amount,approved_at:new Date().toISOString(),approved_by:t.approved_by}})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const o=await r.json();if(o.success)return o.data;throw new Error(o.message||"Failed to register student")}catch(r){return console.error("Error creating student from application:",r),this.createLocalStudentRecord(e,t)}}createLocalStudentRecord(e,t){const r=this.generateUUID(),o=this.generateStudentNumber();return{...e,student_uuid:r,student_number:o,id:Date.now(),created_via:"ssc_approval",source_application_id:t.id}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}generateStudentNumber(){const e=new Date().getFullYear(),t=Math.floor(Math.random()*1e4).toString().padStart(4,"0");return`GSM${e}${t}`}async checkStudentExists(e){try{const t=await fetch(`${this.baseURL}/students/check-by-application/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});return t.ok&&(await t.json()).exists||!1}catch(t){return console.error("Error checking if student exists:",t),!1}}async getStudentByApplication(e){try{const t=await fetch(`${this.baseURL}/students/by-application/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});return t.ok&&(await t.json()).data||null}catch(t){return console.error("Error getting student by application:",t),null}}}const c=new s;export{c as default};
